<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Select Course</title>
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="./style-2.css">
    <link rel="stylesheet" href="./style.css">
    <link
        href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Lexend:wght@400;500;600&family=Martian+Mono:wght@300;600&display=swap"
        rel="stylesheet">
    <script>
        function toggleFabMenu() {
            const overlay = document.getElementById('overlay');
            const fabMenuContainer = document.getElementById('fabMenuContainer');
            const fabLogo = document.getElementById('fabLogo'); // Get the logo by its ID
            const fabClose = document.getElementById('fabClose'); // Get the 'X' span by its ID
            const fabContainer = document.getElementById('fabContainer'); // Get the 'X' span by its ID
            const fab = document.getElementById('fab'); // Get the 'X' span by its ID


            // Toggle the active class on the overlay and the FAB menu
            overlay.classList.toggle('active');
            fabMenuContainer.classList.toggle('active');

            // Check if the menu is active or not
            if (fabMenuContainer.classList.contains('active')) {
                // Menu is active, show 'X' and hide logo
                fabLogo.style.display = 'none'; // Hide the logo
                fabClose.style.display = 'block'; // Show the 'X'

            } else {
                // Menu is not active, hide 'X' and show logo
                fabLogo.style.display = 'block'; // Show the logo
                fabClose.style.display = 'none'; // Hide the 'X'
            }
        }

        function reportLostDisc() { 
            window.location.href = 'reportLostDisc.html'; 
        }
        function requestCourse() { 
            window.location.href = 'requestCourse.html'; 
        }
        function openSettings() { 
            window.location.href = 'settings.html'; 
        }
    </script>
    <script>
        // Function to get the value of a query parameter from the URL
        function getQueryParam(parameterName) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(parameterName);
        }

        document.addEventListener('DOMContentLoaded', function() {

            var filter_brand = filter_color = [];
            var filter_course = getQueryParam("course") ? [getQueryParam("course")] : [];
            console.log(filter_course);
            $(document).ready(function(){
                loadDiscs();
                $(document).on('click','#filter-btn',function(e){
                    e.preventDefault(); // Prevent the event from propagating
                    $(".asidebar").toggleClass("open-sidebar");
                    $(".main-wrapper").toggleClass("open-sidebar");
                });

                // $(".main-section, .footer").click(function(){
                //     $(".asidebar").removeClass("open-sidebar");
                // });
            });
            function loadDiscs(){
                var disc_item = '';
                filter_brand =  $("input[name=filter_brand]:checked").map(function(){
                                        return $(this).val();
                                    }).get();
                filter_color =  $("input[name=filter_color]:checked").map(function(){
                                        return $(this).val();
                                    }).get();
                discs_list    = found_discs.filter(filterDiscs);

                // Extract unique brands from the filtered discs
                var uniqueBrands = new Set(discs_list.map(disc => disc.Brand));
                var brands = Array.from(uniqueBrands);

                // Now, use 'brands' to populate your brand list as you did before
                var brandList = document.getElementById('brandList');
                brandList.innerHTML = ''; // Clear existing list items, if any

                brands.forEach(function(brand) {
                    var listItem = document.createElement('li');
                    listItem.innerHTML = `
                        <label class="filter-checkbox">
                            <input type="checkbox" name="filter_brand" value="${brand}">
                            <span class="checkmark"></span>
                            <span class="filter-text">${brand}</span>
                        </label>
                    `;
                    brandList.appendChild(listItem);
                });

                // Extract unique colors
                var uniqueColors = new Set(discs_list.map(disc => disc.Color));
                var colors = Array.from(uniqueColors);

                // Populate color list
                var colorList = document.getElementById('colorList');
                colorList.innerHTML = ''; // Clear existing list items, if any

                colors.forEach(function(color) {
                    var listItem = document.createElement('li');
                    listItem.innerHTML = `
                        <label class="filter-checkbox">
                            <input type="checkbox" name="filter_color" value="${color}">
                            <span class="checkmark"></span>
                            <span class="filter-text">${color}</span>
                        </label>
                    `;
                    colorList.appendChild(listItem);
                });

                $.each(discs_list, function(index, value) {
                
                    disc_item += '<div class="col-6 disc-item'+(index > 5 ? ' hidden' : '')+'">'+
                                        '<div class="course-box">'+
                                            '<div class="course-box-detail">'+
                                                '<div class="course-image">'+
                                                    '<img src="./assets/course-image.png" alt="image">'+
                                                '</div>'+
                                                '<div class="course-list">'+
                                                '<ul>'+
                                                        '<li style="border-top: 1px solid var(--primary-grey);"><img src="./assets/course-icon.png" alt="icon"><span>'+discs_list[index]['Brand']+'</span></li>'+
                                                        '<li><img src="./assets/course-icon1.png" alt="icon"><span>'+discs_list[index]['Color']+ " " + discs_list[index]['Disc']+'</span></li>'+
                                                        '<li><img src="./assets/course-icon2.png" alt="icon"><span>'+discs_list[index]['Name']+'</span></li>'+
                                                    '</ul>'+
                                                '</div>'+
                                            '</div>'+
                                            '<div class="course-bottom">'+
                                                '<div class="course-dis">'+
                                                    '<img src="./assets/rose-icon.png" alt="icon">'+
                                                    '<span>'+discs_list[index]['Course']+'</span>'+
                                                '</div>'+
                                                '<div class="course-button">'+
                                                    '<a href="#" class="course-btn">Claim Disc</a>'+
                                                '</div>'+
                                            '</div>'+
                                        '</div>'+
                                    '</div>';
                });

                $('.course-section .row').html(disc_item);

                if(discs_list.length < 6){
                    $('.main-section .load-more').addClass('hidden');
                }
                else{
                    $('.main-section .load-more').removeClass('hidden');
                }

                $(".asidebar").removeClass("open-sidebar");
                $(".main-wrapper").removeClass("open-sidebar");

                // Check if there are hidden discs left
                // if ($('.disc-item.hidden').length === 0) {
                //     $('.load-more .more-btn').hide(); // Hide Load More button
                //     $('.load-more .no-more-discs').removeClass('hidden'); // Show the message
                // } else {
                //     $('.load-more .more-btn').show(); // Show Load More button
                //     $('.load-more .no-more-discs').addClass('hidden'); // Hide the message
                // }
            }

            function filterDiscs(discItem){
                // First, check if the disc matches the selected course(s)
                if (filter_course.length && $.inArray(discItem['Course'], filter_course) < 0) {
                    return false; // If it doesn't match any selected course, exclude it immediately
                }

                // Then, check for brand and color filters
                return (!filter_brand.length || $.inArray(discItem['Brand'], filter_brand) >= 0) &&
                    (!filter_color.length || $.inArray(discItem['Color'], filter_color) >= 0);
            }


            function resetFilters(){
                $("input[name=filter_brand]:checked,input[name=filter_color]:checked").prop("checked",false);
                loadDiscs();
            }


        });

        function loadMoreDiscs() {
                $('.disc-item.hidden').removeClass('hidden'); // Reveal hidden discs

                // Check if there are hidden discs left
                if ($('.disc-item.hidden').length === 0) {
                    $('.load-more .more-btn').hide(); // Hide Load More button
                    $('.load-more .no-more-discs').removeClass('hidden'); // Show the message
                }
            }
    </script>
</head>

<body>
    <div class="main-wrapper">
        <section class="main-section text-center" style="padding-bottom: 20px !important;">
            <div class="container">
                <div class="d-flex align-items-center flex-column text-center mb-2">
                    <img class="weblogo" src="./assets/logo.png" alt="logo">
    
                    <div class="chat-box d-flex align-items-center mt-1">
                        <img class="me-2" src="./assets/chat.svg" alt="chat">
                        <h4 class="m-0 me-2 text-white">OPT IN STATUS</h4>
                        <h4 class="m-0 confirmd">CONFIRMED</h4>
                    </div>
                </div>
                <div class="rescue d-flex align-items-center flex-column text-center mb-2">
                    <h3 class="m-0 text-white">ALL LOST <span class="fw-light">DISCS</span></h3>
                    <p class="course-name"></p> <!-- Course name will be displayed here -->
                </div>
                <div class="filter-button">
                    <button class="filter-btn" id="filter-btn">Filters</button>
                </div>
                <div class="course-section">
                    <div class="row"></div>
                    <div class="load-more">
                        <!-- <a href="javascript:void(0);" onclick="$('.disc-item.hidden').removeClass('hidden');" class="more-btn">Load More</a> -->
                        <a href="javascript:void(0);" onclick="loadMoreDiscs();" class="more-btn">Load More</a>
                        <div class="no-more-discs hidden">That's all we have for now!</div>
                    </div>
                </div>
            </div>
        </section>
    </div>
    <div class="fab-menu-container" id="fabMenuContainer">
        <div class="fab-menu" id="fabMenu">

            <div class="fab-menu-item">
                <a class="fab-menu-item-text-left" href="/reportLostDisc.html" style="text-decoration: none;">Report <br /> Lost Disc</a>
                <i class="fa-regular fa-flag" onclick="reportLostDisc()"></i>
            </div>
            <div class="fab-menu-item">
                <a class="fab-menu-item-text" href="/requestCourse.html" style="text-decoration: none;">Request a Course</a>
                <i class="fa-solid fa-location-dot" onclick="requestCourse()"></i>
            </div>
            <div class="fab-menu-item">
                <i class="fa-solid fa-gear" onclick="openSettings()"></i>
                <a class="fab-menu-item-text-right" href="/settings.html" style="text-decoration: none;">Settings</a>
            </div>
        </div>
    </div>


    <footer class="footer">
        <div class="overlay" id="overlay" onclick="toggleFabMenu()"></div>
        <div class="container">
            <div class="footer-content row">
                <div class="col-2 ">
                    <a class="d-flex align-items-center flex-column" href="/">
                        <span class="img">
                            <img src="./assets/home.png" alt="home">
                        </span>
                        <span>HOME</span>
                    </a>
                </div>
                <div class="col-2 ">
                    <a class="d-flex align-items-center flex-column" href="/searchInventory.html">
                        <span class="img">
                            <img class="search" src="./assets/search.png" alt="home" width="18">
                        </span>
                        <span>SEARCH ALL</span>
                    </a>
                </div>
                <div class="col-2 ">
                    <a class=" d-flex align-items-center flex-column" href="/store.html">
                        <span class="img">
                            <img src="./assets/disk-store.png" alt="home">
                        </span>
                        <span>DISC STORE</span>
                    </a>

                </div>
                <div class="col-2">
                    <a class="d-flex align-items-center flex-column" href="/courses.html">
                        <span class="img">
                            <img src="./assets/courses.png" alt="home">
                        </span>
                        <span>COURSES</span>
                    </a>
                </div>
            </div>
        </div>
    </footer>

    <div class="fab-container" onclick="toggleFabMenu()" id="fabContainer">
        <button class="fab" id="fab">
            <img src="./assets/app_center_btn_logo.png" alt="Disc Rescue Network Logo" class="logo-fab" id="fabLogo">
            <span id="fabClose" style="display: none; z-index: 15;">X</span> <!-- Hidden by default -->
        </button>
    </div>
    <div class="asidebar">
        <div class="sidebar-header">
            <h2>FILTER AND SORT</h2>
        </div>
        <div class="filter-body">
            <div class="accordion" id="accordionExample">
                <div class="accordion-item">
                    <h2 class="accordion-header" id="headingOne">
                        <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                            Disc Brand
                        </button>
                    </h2>
                    <div id="collapseOne" class="accordion-collapse collapse show" aria-labelledby="headingOne">
                        <div class="accordion-body">
                            <ul id="brandList"> <!-- This is where the list items will be appended -->
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="accordion-item">
                    <h2 class="accordion-header" id="headingTwo">
                        <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwo" aria-expanded="true" aria-controls="collapseTwo">
                            Disc Color
                        </button>
                    </h2>
                    <div id="collapseTwo" class="accordion-collapse collapse show" aria-labelledby="headingTwo">
                        <div class="accordion-body">
                            <ul id="colorList"> <!-- This is where the list items will be appended -->
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <div class="filter-footer">
                <a href="javascript:void(0);" class="filter-search" onclick="loadDiscs();">Filter and Search</a>
                <a href="javascript:void(0);" class="filter-reset" onclick="resetFilters();">Reset Filters</a>
            </div>
        </div>
        
    </div>
   
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/discs.js"></script>
</body>

</html>